<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="基于数据分析的借贷用户分类预测, SUIBE DeepLearning 张国祥 guoxiang 上外贸 数据分析 深度学习 上海对外经贸大学">
    <meta name="description" content="上海对外经贸大学 | 管理科学与工程 | 数据分析、机器学习、图网络">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>基于数据分析的借贷用户分类预测 | Singularity&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.1.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Singularity&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Singularity&#39;s Blog</div>
        <div class="logo-desc">
            
            上海对外经贸大学 | 管理科学与工程 | 数据分析、机器学习、图网络
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/5.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">基于数据分析的借贷用户分类预测</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                                <span class="chip bg-color">机器学习</span>
                            </a>
                        
                            <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                                <span class="chip bg-color">学习笔记</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="post-category">
                                机器学习
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-05-02
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    52 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="基于数据分析的借贷用户分类预测"><a href="#基于数据分析的借贷用户分类预测" class="headerlink" title="基于数据分析的借贷用户分类预测"></a>基于数据分析的借贷用户分类预测</h2><p> 1 - 数据描述+统计</p>
<pre class=" language-python"><code class="language-python">
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>r<span class="token string">"d:/Data/pymen"</span><span class="token punctuation">)</span>
col <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Existing checking accout'</span><span class="token punctuation">,</span><span class="token string">'Duration in month'</span><span class="token punctuation">,</span><span class="token string">'Credit history'</span><span class="token punctuation">,</span><span class="token string">'Purpurse'</span><span class="token punctuation">,</span><span class="token string">'Credit amount'</span><span class="token punctuation">,</span>
       <span class="token string">'Savings account'</span><span class="token punctuation">,</span><span class="token string">'Present employment'</span><span class="token punctuation">,</span><span class="token string">'Installment rate'</span><span class="token punctuation">,</span><span class="token string">'Status and sex'</span><span class="token punctuation">,</span><span class="token string">'Other debtors'</span><span class="token punctuation">,</span>
       <span class="token string">'Present residence'</span><span class="token punctuation">,</span><span class="token string">'Property'</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">,</span><span class="token string">'Installmentplans'</span><span class="token punctuation">,</span><span class="token string">'Housing state'</span><span class="token punctuation">,</span>
       <span class="token string">'Existing credits number'</span><span class="token punctuation">,</span><span class="token string">'Job'</span><span class="token punctuation">,</span><span class="token string">'Maintenance number'</span><span class="token punctuation">,</span><span class="token string">'Telephone'</span><span class="token punctuation">,</span><span class="token string">'Foreign worker'</span><span class="token punctuation">,</span><span class="token string">'target'</span><span class="token punctuation">]</span>
datas <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'german.data'</span><span class="token punctuation">,</span>header<span class="token operator">=</span>None<span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
datas<span class="token punctuation">.</span>columns <span class="token operator">=</span> col
<span class="token comment" spellcheck="true"># datas.head()</span>
datas<span class="token punctuation">[</span><span class="token string">'Existing checking accout'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
cc <span class="token operator">=</span> datas<span class="token punctuation">[</span><span class="token string">'Existing checking accout'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>

xx <span class="token operator">=</span> datas<span class="token punctuation">[</span><span class="token string">'Existing checking accout'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># datas.isnull().sum()</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># plt.plot(xx, cc, 'b')</span>
plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>cc<span class="token punctuation">,</span>color <span class="token operator">=</span> <span class="token string">'steelblue'</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#设置X轴的文字</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#设置Y轴的范围</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Existing checking accout'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#设置图表的标题</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#显示图示</span></code></pre>
<pre><code>&lt;Figure size 500x500 with 1 Axes&gt;</code></pre>
<pre class=" language-python"><code class="language-python">datas<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
datas<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 21 columns):
Existing checking accout    1000 non-null object
Duration in month           1000 non-null int64
Credit history              1000 non-null object
Purpurse                    1000 non-null object
Credit amount               1000 non-null int64
Savings account             1000 non-null object
Present employment          1000 non-null object
Installment rate            1000 non-null int64
Status and sex              1000 non-null object
Other debtors               1000 non-null object
Present residence           1000 non-null int64
Property                    1000 non-null object
Age                         1000 non-null int64
Installmentplans            1000 non-null object
Housing state               1000 non-null object
Existing credits number     1000 non-null int64
Job                         1000 non-null object
Maintenance number          1000 non-null int64
Telephone                   1000 non-null object
Foreign worker              1000 non-null object
target                      1000 non-null int64
dtypes: int64(8), object(13)
memory usage: 164.1+ KB</code></pre>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;</code></pre>
<p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Duration in month</th>
      <th>Credit amount</th>
      <th>Installment rate</th>
      <th>Present residence</th>
      <th>Age</th>
      <th>Existing credits number</th>
      <th>Maintenance number</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>20.903000</td>
      <td>3271.258000</td>
      <td>2.973000</td>
      <td>2.845000</td>
      <td>35.546000</td>
      <td>1.407000</td>
      <td>1.155000</td>
      <td>1.300000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>12.058814</td>
      <td>2822.736876</td>
      <td>1.118715</td>
      <td>1.103718</td>
      <td>11.375469</td>
      <td>0.577654</td>
      <td>0.362086</td>
      <td>0.458487</td>
    </tr>
    <tr>
      <th>min</th>
      <td>4.000000</td>
      <td>250.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>19.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.000000</td>
      <td>1365.500000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>27.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>18.000000</td>
      <td>2319.500000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>33.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>24.000000</td>
      <td>3972.250000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>42.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>72.000000</td>
      <td>18424.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>75.000000</td>
      <td>4.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
    </tr>
  </tbody>
</table>
</div>




<pre class=" language-python"><code class="language-python">numeric_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Duration in month'</span><span class="token punctuation">,</span>
                    <span class="token string">'Credit amount'</span><span class="token punctuation">,</span>
                    <span class="token string">'Installment rate'</span><span class="token punctuation">,</span>
                    <span class="token string">'Present residence'</span><span class="token punctuation">,</span><span class="token string">'Age'</span><span class="token punctuation">,</span>
                    <span class="token string">'Existing credits number'</span><span class="token punctuation">,</span>
                    <span class="token string">'Maintenance number'</span><span class="token punctuation">,</span><span class="token string">'target'</span><span class="token punctuation">]</span>

categorical_features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Existing checking accout'</span><span class="token punctuation">,</span>
                        <span class="token string">'Credit history'</span><span class="token punctuation">,</span>
                        <span class="token string">'Purpurse'</span><span class="token punctuation">,</span>
                        <span class="token string">'Savings account'</span><span class="token punctuation">,</span>
                        <span class="token string">'Present employment'</span><span class="token punctuation">,</span>
                        <span class="token string">'Status and sex'</span><span class="token punctuation">,</span>
                        <span class="token string">'Property'</span><span class="token punctuation">,</span>
                        <span class="token string">'Job'</span><span class="token punctuation">,</span><span class="token string">'Other debtors'</span><span class="token punctuation">,</span>
                        <span class="token string">'Installmentplans'</span><span class="token punctuation">,</span>
                        <span class="token string">'Housing state'</span><span class="token punctuation">,</span>
                        <span class="token string">'Telephone'</span><span class="token punctuation">,</span><span class="token string">'Foreign worker'</span> <span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">## 类型特征 自动抓取 如果数据被label encode后 则不适用</span>
categorical_f <span class="token operator">=</span> datas<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>object<span class="token punctuation">]</span><span class="token punctuation">)</span>
categorical_f<span class="token punctuation">.</span>columns
<span class="token comment" spellcheck="true"># 数字特征 自动抓取</span>
numeric_f <span class="token operator">=</span> datas<span class="token punctuation">.</span>select_dtypes<span class="token punctuation">(</span>include<span class="token operator">=</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>
numeric_f<span class="token punctuation">.</span>columns</code></pre>
<pre><code>Index(['Duration in month', 'Credit amount', 'Installment rate',
       'Present residence', 'Age', 'Existing credits number',
       'Maintenance number', 'target'],
      dtype='object')</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ## 类别型变量分布统计 </span>
<span class="token comment" spellcheck="true"># fig, axes = plt.subplots(3, 5, figsize=(30, 20))</span>
<span class="token comment" spellcheck="true"># coun = 0</span>
<span class="token comment" spellcheck="true"># for i in categorical_features: </span>
<span class="token comment" spellcheck="true">#     cc = datas[i].value_counts()</span>
<span class="token comment" spellcheck="true">#     xx = datas[i].unique()</span>
<span class="token comment" spellcheck="true">#     # datas.isnull().sum()</span>
<span class="token comment" spellcheck="true">#     plt.subplot(3,5,coun+1)</span>
<span class="token comment" spellcheck="true">#     coun += 1</span>
<span class="token comment" spellcheck="true">#     plt.bar(xx,cc,color = 'steelblue', alpha = 0.8)</span>
<span class="token comment" spellcheck="true">#     plt.xlabel("type",fontsize='xx-large')   #设置X轴的文字</span>
<span class="token comment" spellcheck="true">#     plt.ylabel("count",fontsize='xx-large')</span>
<span class="token comment" spellcheck="true">#     plt.tick_params(labelsize=15)</span>
<span class="token comment" spellcheck="true">#     plt.ylim(0, 1000)    #设置Y轴的范围</span>
<span class="token comment" spellcheck="true">#     plt.title(i,fontsize='xx-large',color='r')    #设置图表的标题</span>
<span class="token comment" spellcheck="true">#     plt.subplots_adjust(wspace =0, hspace =0)#调整子图间距</span>
<span class="token comment" spellcheck="true"># fig.tight_layout()#调整整体空白</span>
<span class="token comment" spellcheck="true"># plt.show()   #显示图示</span>
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token comment" spellcheck="true">##  类别特征的每个类别频数可视化(count_plot)</span>
<span class="token keyword">def</span> <span class="token function">count_plot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>  <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>x<span class="token operator">=</span>x<span class="token punctuation">)</span>
    x<span class="token operator">=</span>plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>

f <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>datas<span class="token punctuation">,</span>  value_vars<span class="token operator">=</span>categorical_features<span class="token punctuation">)</span>
g <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>f<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">"variable"</span><span class="token punctuation">,</span>  col_wrap<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> sharex<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sharey<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">3.5</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># size 越小 标签文字越大</span>
g <span class="token operator">=</span> g<span class="token punctuation">.</span>map<span class="token punctuation">(</span>count_plot<span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span>
</code></pre>
<pre><code>D:\Anaconda3-python3.7\lib\site-packages\seaborn\axisgrid.py:230: UserWarning: The `size` paramter has been renamed to `height`; please update your code.
  warnings.warn(msg, UserWarning)</code></pre>
<p><img src="output_4_1.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 类别特征</span>
<span class="token comment" spellcheck="true"># unique分布</span>
<span class="token keyword">for</span> fea <span class="token keyword">in</span> categorical_features<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>fea<span class="token punctuation">,</span><span class="token string">':\n'</span><span class="token punctuation">,</span>datas<span class="token punctuation">[</span>fea<span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">':'</span><span class="token punctuation">,</span>datas<span class="token punctuation">[</span>fea<span class="token punctuation">]</span><span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>Existing checking accout :
 ['A11' 'A12' 'A14' 'A13'] : 4
Credit history :
 ['A34' 'A32' 'A33' 'A30' 'A31'] : 5
Purpurse :
 ['A43' 'A46' 'A42' 'A40' 'A41' 'A49' 'A44' 'A45' 'A410' 'A48'] : 10
Savings account :
 ['A65' 'A61' 'A63' 'A64' 'A62'] : 5
Present employment :
 ['A75' 'A73' 'A74' 'A71' 'A72'] : 5
Status and sex :
 ['A93' 'A92' 'A91' 'A94'] : 4
Property :
 ['A121' 'A122' 'A124' 'A123'] : 4
Job :
 ['A173' 'A172' 'A174' 'A171'] : 4
Other debtors :
 ['A101' 'A103' 'A102'] : 3
Installmentplans :
 ['A143' 'A141' 'A142'] : 3
Housing state :
 ['A152' 'A153' 'A151'] : 3
Telephone :
 ['A192' 'A191'] : 2
Foreign worker :
 ['A201' 'A202'] : 2</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">##  类别特征箱形图可视化</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> categorical_features<span class="token punctuation">:</span>
    datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>any<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>cat<span class="token punctuation">.</span>add_categories<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'MISSING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> datas<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'MISSING'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">boxplot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>x<span class="token operator">=</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">)</span>
    x<span class="token operator">=</span>plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>

f <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>datas<span class="token punctuation">,</span> id_vars<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value_vars<span class="token operator">=</span>categorical_features<span class="token punctuation">)</span>
g <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>f<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">"variable"</span><span class="token punctuation">,</span>  col_wrap<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> sharex<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sharey<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
g <span class="token operator">=</span> g<span class="token punctuation">.</span>map<span class="token punctuation">(</span>boxplot<span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">,</span> <span class="token string">"target"</span><span class="token punctuation">)</span></code></pre>
<pre><code>D:\Anaconda3-python3.7\lib\site-packages\seaborn\axisgrid.py:230: UserWarning: The `size` paramter has been renamed to `height`; please update your code.
  warnings.warn(msg, UserWarning)</code></pre>
<p><img src="output_6_1.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 类别特征的小提琴图可视化</span>
fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
catg_list <span class="token operator">=</span> categorical_features
count <span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> catg <span class="token keyword">in</span> catg_list <span class="token punctuation">:</span>
<span class="token comment" spellcheck="true">#     cc = datas[catg].value_counts()</span>
<span class="token comment" spellcheck="true">#     xx = datas[i].unique()</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    count <span class="token operator">+=</span><span class="token number">1</span> 
    sns<span class="token punctuation">.</span>violinplot<span class="token punctuation">(</span>x<span class="token operator">=</span>catg<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'target'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>datas<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># g = sns.FacetGrid(f, col="variable",  col_wrap=4, sharex=False, sharey=False)</span>
<span class="token comment" spellcheck="true"># g = g.map(sns.distplot, "value")</span></code></pre>
<p><img src="output_7_0.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 数值型变量分布统计</span>
fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
coun <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> numeric_features<span class="token punctuation">:</span>
<span class="token comment" spellcheck="true">#     print(datas[k].describe()) 上文已进行均值等数据描述</span>
<span class="token comment" spellcheck="true">#     print(datas[k].value_counts())</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>coun<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    coun <span class="token operator">+=</span> <span class="token number">1</span>
    plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>datas<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> orientation <span class="token operator">=</span> <span class="token string">'vertical'</span><span class="token punctuation">,</span>histtype <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> color <span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>k<span class="token punctuation">,</span>fontsize <span class="token operator">=</span> <span class="token string">'xx-large'</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># log变换 之后的分布较均匀，可以进行log变换进行预测，这也是预测问题常用的trick</span></code></pre>
<p><img src="output_8_0.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 相关性分析</span>
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
target_numeric <span class="token operator">=</span> datas<span class="token punctuation">[</span>numeric_features<span class="token punctuation">]</span>
correlation <span class="token operator">=</span>  target_numeric<span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'目标列与其他数值特征的相关性：'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>correlation<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">## 可视化</span>
f <span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Correlation of Numeric Features with Target'</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>correlation<span class="token punctuation">,</span>square <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>  vmax<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
</code></pre>
<pre><code>目标列与其他数值特征的相关性：
target                     1.000000
Duration in month          0.214927
Credit amount              0.154739
Installment rate           0.072404
Present residence          0.002967
Maintenance number        -0.003015
Existing credits number   -0.045732
Age                       -0.091127
Name: target, dtype: float64 </code></pre>
<p>​    </p>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x186b5125828&gt;</code></pre>
<p><img src="output_9_2.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">##  查看数字特征得 偏度和峰值</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> numeric_features<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&amp;#123;:15&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>col<span class="token punctuation">)</span><span class="token punctuation">,</span> 
          <span class="token string">'Skewness: &amp;#123;:05.2f&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>datas<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>skew<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> 
          <span class="token string">'   '</span> <span class="token punctuation">,</span>
          <span class="token string">'Kurtosis: &amp;#123;:06.2f&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>datas<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>kurt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
         <span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">## 可视化</span>
f <span class="token operator">=</span> pd<span class="token punctuation">.</span>melt<span class="token punctuation">(</span>datas<span class="token punctuation">,</span> value_vars<span class="token operator">=</span>numeric_features<span class="token punctuation">)</span>
g <span class="token operator">=</span> sns<span class="token punctuation">.</span>FacetGrid<span class="token punctuation">(</span>f<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string">"variable"</span><span class="token punctuation">,</span>  col_wrap<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> sharex<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sharey<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
g <span class="token operator">=</span> g<span class="token punctuation">.</span>map<span class="token punctuation">(</span>sns<span class="token punctuation">.</span>distplot<span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span></code></pre>
<pre><code>Duration in month Skewness: 01.09     Kurtosis: 000.92
Credit amount   Skewness: 01.95     Kurtosis: 004.29
Installment rate Skewness: -0.53     Kurtosis: -01.21
Present residence Skewness: -0.27     Kurtosis: -01.38
Age             Skewness: 01.02     Kurtosis: 000.60
Existing credits number Skewness: 01.27     Kurtosis: 001.60
Maintenance number Skewness: 01.91     Kurtosis: 001.65
target          Skewness: 00.87     Kurtosis: -01.24</code></pre>
<p><img src="output_10_1.png" alt="png"></p>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 2.对类别型变量进行one hot编码</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

catogory_cols <span class="token operator">=</span> categorical_features
<span class="token keyword">print</span><span class="token punctuation">(</span>datas<span class="token punctuation">[</span>catogory_cols<span class="token punctuation">]</span><span class="token punctuation">)</span>
dummies <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>datas<span class="token punctuation">[</span>catogory_cols<span class="token punctuation">]</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>datas<span class="token punctuation">,</span>dummies<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> catogory_cols<span class="token punctuation">:</span>
    data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>shape</code></pre>
<pre><code>    Existing checking accout Credit history Purpurse Savings account  \
0                        A11            A34      A43             A65   
1                        A12            A32      A43             A61   
2                        A14            A34      A46             A61   
3                        A11            A32      A42             A61   
4                        A11            A33      A40             A61   
5                        A14            A32      A46             A65   
6                        A14            A32      A42             A63   
7                        A12            A32      A41             A61   
8                        A14            A32      A43             A64   
9                        A12            A34      A40             A61   
10                       A12            A32      A40             A61   
11                       A11            A32      A49             A61   
12                       A12            A32      A43             A61   
13                       A11            A34      A40             A61   
14                       A11            A32      A40             A61   
15                       A11            A32      A43             A62   
16                       A14            A34      A43             A65   
17                       A11            A30      A49             A65   
18                       A12            A32      A41             A61   
19                       A14            A32      A43             A63   
20                       A14            A34      A40             A61   
21                       A11            A32      A43             A63   
22                       A11            A34      A40             A61   
23                       A12            A34      A41             A62   
24                       A14            A34      A42             A65   
25                       A11            A32      A42             A61   
26                       A14            A30      A43             A61   
27                       A13            A31      A43             A64   
28                       A12            A32      A43             A61   
29                       A11            A33      A49             A61   
..                       ...            ...      ...             ...   
970                      A12            A32      A45             A62   
971                      A14            A32      A40             A61   
972                      A11            A31      A40             A61   
973                      A11            A32      A49             A61   
974                      A14            A34      A43             A61   
975                      A13            A32      A43             A63   
976                      A12            A32      A43             A61   
977                      A12            A33      A49             A65   
978                      A14            A33      A40             A61   
979                      A12            A31      A40             A62   
980                      A12            A34      A42             A61   
981                      A14            A32      A49             A61   
982                      A13            A32      A40             A62   
983                      A11            A32      A41             A61   
984                      A14            A34      A42             A61   
985                      A11            A34      A42             A61   
986                      A13            A30      A49             A61   
987                      A14            A32      A43             A62   
988                      A11            A32      A41             A61   
989                      A12            A34      A43             A61   
990                      A14            A34      A46             A65   
991                      A14            A31      A43             A62   
992                      A11            A32      A43             A65   
993                      A11            A32      A42             A61   
994                      A14            A32      A40             A65   
995                      A14            A32      A42             A61   
996                      A11            A32      A41             A61   
997                      A14            A32      A43             A61   
998                      A11            A32      A43             A61   
999                      A12            A34      A41             A62   

    Present employment Status and sex Property   Job Other debtors  \
0                  A75            A93     A121  A173          A101   
1                  A73            A92     A121  A173          A101   
2                  A74            A93     A121  A172          A101   
3                  A74            A93     A122  A173          A103   
4                  A73            A93     A124  A173          A101   
5                  A73            A93     A124  A172          A101   
6                  A75            A93     A122  A173          A101   
7                  A73            A93     A123  A174          A101   
8                  A74            A91     A121  A172          A101   
9                  A71            A94     A123  A174          A101   
10                 A72            A92     A123  A173          A101   
11                 A72            A92     A122  A173          A101   
12                 A73            A92     A123  A173          A101   
13                 A75            A93     A123  A172          A101   
14                 A73            A92     A123  A173          A101   
15                 A73            A92     A123  A172          A101   
16                 A75            A93     A122  A173          A101   
17                 A72            A93     A123  A173          A101   
18                 A75            A92     A124  A174          A101   
19                 A75            A93     A123  A173          A101   
20                 A73            A93     A123  A173          A101   
21                 A73            A93     A121  A173          A101   
22                 A72            A93     A121  A172          A101   
23                 A72            A93     A122  A173          A101   
24                 A73            A94     A123  A173          A101   
25                 A73            A93     A121  A172          A101   
26                 A75            A94     A123  A172          A101   
27                 A73            A92     A121  A173          A101   
28                 A73            A93     A121  A173          A103   
29                 A75            A93     A124  A173          A101   
..                 ...            ...      ...   ...           ...   
970                A73            A93     A121  A173          A103   
971                A73            A93     A122  A172          A101   
972                A71            A92     A124  A171          A102   
973                A75            A93     A124  A173          A102   
974                A73            A92     A123  A173          A101   
975                A73            A92     A123  A172          A101   
976                A73            A92     A121  A173          A103   
977                A75            A93     A122  A173          A101   
978                A75            A93     A123  A172          A101   
979                A73            A94     A122  A173          A101   
980                A74            A93     A122  A173          A101   
981                A71            A93     A123  A174          A101   
982                A73            A92     A123  A174          A101   
983                A73            A93     A122  A173          A101   
984                A74            A93     A122  A172          A101   
985                A73            A92     A122  A173          A101   
986                A72            A91     A122  A173          A101   
987                A71            A92     A121  A173          A101   
988                A71            A93     A124  A174          A101   
989                A75            A93     A122  A172          A101   
990                A72            A93     A122  A172          A101   
991                A75            A93     A123  A172          A101   
992                A74            A94     A123  A172          A101   
993                A71            A93     A122  A174          A101   
994                A75            A93     A123  A173          A101   
995                A74            A92     A121  A172          A101   
996                A73            A91     A122  A174          A101   
997                A75            A93     A123  A173          A101   
998                A73            A93     A124  A173          A101   
999                A71            A93     A123  A173          A101   

    Installmentplans Housing state Telephone Foreign worker  
0               A143          A152      A192           A201  
1               A143          A152      A191           A201  
2               A143          A152      A191           A201  
3               A143          A153      A191           A201  
4               A143          A153      A191           A201  
5               A143          A153      A192           A201  
6               A143          A152      A191           A201  
7               A143          A151      A192           A201  
8               A143          A152      A191           A201  
9               A143          A152      A191           A201  
10              A143          A151      A191           A201  
11              A143          A151      A191           A201  
12              A143          A152      A192           A201  
13              A143          A152      A191           A201  
14              A143          A151      A191           A201  
15              A143          A152      A191           A201  
16              A143          A152      A191           A201  
17              A141          A152      A191           A201  
18              A143          A153      A192           A201  
19              A143          A152      A192           A201  
20              A143          A152      A192           A201  
21              A143          A151      A191           A201  
22              A143          A151      A191           A202  
23              A143          A152      A191           A201  
24              A143          A152      A191           A202  
25              A141          A152      A192           A201  
26              A143          A152      A191           A201  
27              A143          A151      A191           A201  
28              A143          A152      A191           A201  
29              A143          A152      A192           A201  
..               ...           ...       ...            ...  
970             A143          A152      A191           A201  
971             A143          A152      A191           A201  
972             A143          A151      A191           A201  
973             A143          A151      A191           A201  
974             A143          A152      A192           A201  
975             A143          A152      A191           A201  
976             A143          A152      A191           A201  
977             A143          A152      A191           A201  
978             A143          A152      A191           A201  
979             A143          A151      A191           A201  
980             A143          A152      A191           A201  
981             A141          A151      A192           A201  
982             A141          A152      A192           A201  
983             A143          A152      A191           A201  
984             A143          A152      A191           A201  
985             A143          A151      A191           A201  
986             A143          A152      A191           A201  
987             A143          A152      A191           A201  
988             A143          A153      A192           A201  
989             A143          A152      A191           A201  
990             A143          A152      A191           A201  
991             A141          A152      A191           A201  
992             A143          A151      A191           A201  
993             A143          A152      A192           A201  
994             A143          A152      A192           A201  
995             A143          A152      A191           A201  
996             A143          A152      A192           A201  
997             A143          A152      A191           A201  
998             A143          A153      A192           A201  
999             A143          A152      A191           A201  

[1000 rows x 13 columns]





(1000, 62)</code></pre>
<pre class=" language-python"><code class="language-python">data<span class="token punctuation">.</span>columns</code></pre>
<pre><code>Index(['Duration in month', 'Credit amount', 'Installment rate',
       'Present residence', 'Age', 'Existing credits number',
       'Maintenance number', 'target', 'Existing checking accout_A11',
       'Existing checking accout_A12', 'Existing checking accout_A13',
       'Existing checking accout_A14', 'Credit history_A30',
       'Credit history_A31', 'Credit history_A32', 'Credit history_A33',
       'Credit history_A34', 'Purpurse_A40', 'Purpurse_A41', 'Purpurse_A410',
       'Purpurse_A42', 'Purpurse_A43', 'Purpurse_A44', 'Purpurse_A45',
       'Purpurse_A46', 'Purpurse_A48', 'Purpurse_A49', 'Savings account_A61',
       'Savings account_A62', 'Savings account_A63', 'Savings account_A64',
       'Savings account_A65', 'Present employment_A71',
       'Present employment_A72', 'Present employment_A73',
       'Present employment_A74', 'Present employment_A75',
       'Status and sex_A91', 'Status and sex_A92', 'Status and sex_A93',
       'Status and sex_A94', 'Property_A121', 'Property_A122', 'Property_A123',
       'Property_A124', 'Job_A171', 'Job_A172', 'Job_A173', 'Job_A174',
       'Other debtors_A101', 'Other debtors_A102', 'Other debtors_A103',
       'Installmentplans_A141', 'Installmentplans_A142',
       'Installmentplans_A143', 'Housing state_A151', 'Housing state_A152',
       'Housing state_A153', 'Telephone_A191', 'Telephone_A192',
       'Foreign worker_A201', 'Foreign worker_A202'],
      dtype='object')</code></pre>
<h2 id="思考：是否要对数字变量进行异常值检测"><a href="#思考：是否要对数字变量进行异常值检测" class="headerlink" title="思考：是否要对数字变量进行异常值检测"></a>思考：是否要对数字变量进行异常值检测</h2><h2 id="如果要删除异常值，则只能在训练集上进行"><a href="#如果要删除异常值，则只能在训练集上进行" class="headerlink" title="如果要删除异常值，则只能在训练集上进行"></a>如果要删除异常值，则只能在训练集上进行</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 这里我包装了一个异常值处理的代码，可以随便调用。</span>
<span class="token keyword">def</span> <span class="token function">outliers_proc</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> col_name<span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    用于清洗异常值，默认用 box_plot（scale=3）进行清洗
    :param data: 接收 pandas 数据格式
    :param col_name: pandas 列名
    :param scale: 尺度
    :return:
    """</span>

    <span class="token keyword">def</span> <span class="token function">box_plot_outliers</span><span class="token punctuation">(</span>data_ser<span class="token punctuation">,</span> box_scale<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        利用箱线图去除异常值
        :param data_ser: 接收 pandas.Series 数据格式
        :param box_scale: 箱线图尺度，
        :return:
        """</span>
        iqr <span class="token operator">=</span> box_scale <span class="token operator">*</span> <span class="token punctuation">(</span>data_ser<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">-</span> data_ser<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        val_low <span class="token operator">=</span> data_ser<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span> <span class="token operator">-</span> iqr
        val_up <span class="token operator">=</span> data_ser<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">)</span> <span class="token operator">+</span> iqr
        rule_low <span class="token operator">=</span> <span class="token punctuation">(</span>data_ser <span class="token operator">&lt;</span> val_low<span class="token punctuation">)</span>
        rule_up <span class="token operator">=</span> <span class="token punctuation">(</span>data_ser <span class="token operator">></span> val_up<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>rule_low<span class="token punctuation">,</span> rule_up<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>val_low<span class="token punctuation">,</span> val_up<span class="token punctuation">)</span>

    data_n <span class="token operator">=</span> data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data_series <span class="token operator">=</span> data_n<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span>
    rule<span class="token punctuation">,</span> value <span class="token operator">=</span> box_plot_outliers<span class="token punctuation">(</span>data_series<span class="token punctuation">,</span> box_scale<span class="token operator">=</span>scale<span class="token punctuation">)</span>
    index <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>data_series<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>rule<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">|</span> rule<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Delete number is: &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data_n <span class="token operator">=</span> data_n<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>index<span class="token punctuation">)</span>
    data_n<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Now column number is: &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>data_n<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    index_low <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>data_series<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>rule<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    outliers <span class="token operator">=</span> data_series<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index_low<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Description of data less than the lower bound is:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>outliers<span class="token punctuation">)</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    index_up <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>data_series<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>rule<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    outliers <span class="token operator">=</span> data_series<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index_up<span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Description of data larger than the upper bound is:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>outliers<span class="token punctuation">)</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>y<span class="token operator">=</span>data<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> palette<span class="token operator">=</span><span class="token string">"Set1"</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>y<span class="token operator">=</span>data_n<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data_n<span class="token punctuation">,</span> palette<span class="token operator">=</span><span class="token string">"Set1"</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data_n</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 数值型变量后续可以进行 数据分桶操作</span>
<span class="token comment" spellcheck="true">## 对 Age 进行分桶  ## </span>
data <span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

bin <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">10</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
data<span class="token punctuation">[</span><span class="token string">'age_bin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bin<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'age_bin'</span><span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>columns
data<span class="token punctuation">.</span>shape</code></pre>
<pre><code>(1000, 63)</code></pre>
<pre class=" language-python"><code class="language-python">data<span class="token punctuation">[</span><span class="token string">'age_bin'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">.</span>hist<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x186b7692c50&gt;</code></pre>
<p><img src="output_19_1.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 训练集测试集划分</span>
X <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment" spellcheck="true">## 划分数据集</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> \
        train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> stratify<span class="token operator">=</span>y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#stratified 切分， 使切分后的数据集更好地保留标签的相对比例</span></code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 对 X数据 标准化</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
stdsc <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_train_std <span class="token operator">=</span> stdsc<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
X_test_std <span class="token operator">=</span> stdsc<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># x_train_std</span>
<span class="token comment" spellcheck="true">## 对y数据标签化</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
le <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
y_test <span class="token operator">=</span> le<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>y_test<span class="token punctuation">)</span>
y_train <span class="token operator">=</span> le<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>y_train<span class="token punctuation">)</span></code></pre>
<p>  3 - 模型选择和评价</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## Perceptron classifier.在训练集上  用五折交叉验证,评价准确率accuracy</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> Perceptron
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
ppn <span class="token operator">=</span> Perceptron<span class="token punctuation">(</span>n_iter_no_change<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> eta0<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ppn.fit(X_train_std, y_train) ##五折交叉验证不需要fit</span>
score_p <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>ppn<span class="token punctuation">,</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">##自动包含fit训练过程</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span>
    <span class="token operator">%</span> <span class="token punctuation">(</span>score_p<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> score_p<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Perceptron'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># y_pred = ppn.predict(X_test_std) # predict</span>
<span class="token comment" spellcheck="true"># print('Misclassified samples: %d' % (y_test != y_pred).sum()) # 错误个数</span></code></pre>
<pre><code>Accuracy: 0.69 (+/- 0.07) [Perceptron]


[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.0s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## LogisticRegression 在训练集上 五折交叉验证 accuracy评价</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
lr <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>penalty<span class="token operator">=</span><span class="token string">'l2'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># lr.fit(X_train_std, y_train)</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
scores_R <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>lr<span class="token punctuation">,</span> X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
label <span class="token operator">=</span> <span class="token string">'逻辑回归模型'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span>
    <span class="token operator">%</span> <span class="token punctuation">(</span>scores_R<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scores_R<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>Accuracy: 0.74 (+/- 0.03) [逻辑回归模型]


[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.0s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## SVM 模型 kernel='rbf' 针对非线性问题</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span>C<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>gamma <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#gamma = 0.1</span>
<span class="token comment" spellcheck="true"># svm.fit(X_train_std,y_train)</span>
scores_s <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>svm<span class="token punctuation">,</span> X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span>
    <span class="token operator">%</span> <span class="token punctuation">(</span>scores_s<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scores_s<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'SVM'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy: 0.70 (+/- 0.01) [SVM]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.2s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## SVM模型 kernel='linear'</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>C<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># svm.fit(X_train_std,y_train)</span>
scores_s <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>svm<span class="token punctuation">,</span> X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span>
    <span class="token operator">%</span> <span class="token punctuation">(</span>scores_s<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scores_s<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'SVM'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy: 0.73 (+/- 0.02) [SVM]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.6s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## KNN模型</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
knn <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>p<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>metric<span class="token operator">=</span><span class="token string">'minkowski'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># knn.fit(X_train_std,y_train)</span>
scores_k <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>knn<span class="token punctuation">,</span> X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span>
    <span class="token operator">%</span> <span class="token punctuation">(</span>scores_k<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scores_k<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'KNN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy: 0.73 (+/- 0.03) [KNN]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.1s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 决策树分类</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
tree <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>criterion<span class="token operator">=</span><span class="token string">'entropy'</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># tree.fit(X_train_std, y_train)</span>
scores_d <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>knn<span class="token punctuation">,</span> X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy: %0.2f (+/- %0.2f) [%s]"</span>
    <span class="token operator">%</span> <span class="token punctuation">(</span>scores_d<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scores_d<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'DecisionTree'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy: 0.73 (+/- 0.03) [DecisionTree]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.1s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 集成模型分类：随即森林、多数票机制，bagging，Adaboost</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> VotingClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> BaggingClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> AdaBoostClassifier

clf_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'随即森林'</span><span class="token punctuation">,</span><span class="token string">'多数票机制'</span><span class="token punctuation">,</span><span class="token string">'bagging'</span><span class="token punctuation">,</span><span class="token string">'Adaboost'</span><span class="token punctuation">]</span>
forest <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>criterion<span class="token operator">=</span><span class="token string">'entropy'</span><span class="token punctuation">,</span>
                                n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> 
                                random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                                  n_jobs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 用 tree,knn,lr 作 base </span>
mv_clf <span class="token operator">=</span> VotingClassifier<span class="token punctuation">(</span>
            estimators<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'c1'</span><span class="token punctuation">,</span> lr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'c2'</span><span class="token punctuation">,</span> knn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'c3'</span><span class="token punctuation">,</span> tree<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> voting<span class="token operator">=</span><span class="token string">'soft'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 用 tree 作 base </span>
bag <span class="token operator">=</span> BaggingClassifier<span class="token punctuation">(</span>base_estimator<span class="token operator">=</span>tree<span class="token punctuation">,</span>
                        n_estimators<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> 
                        max_samples<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 子采样 samples 的比例</span>
                        max_features<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 子采样 features 的比例</span>
                        bootstrap<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>   <span class="token comment" spellcheck="true"># 采样 samples 时是否使用 bootstrap</span>
                        bootstrap_features<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 采样 features 时是否使用 bootstrap</span>
                        random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 用 tree 作 base </span>
ada <span class="token operator">=</span> AdaBoostClassifier<span class="token punctuation">(</span>base_estimator<span class="token operator">=</span>tree<span class="token punctuation">,</span>
                         n_estimators<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> 
                         learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
                         random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
all_clf <span class="token operator">=</span><span class="token punctuation">[</span>forest<span class="token punctuation">,</span>mv_clf<span class="token punctuation">,</span>bag<span class="token punctuation">,</span>ada<span class="token punctuation">]</span>

<span class="token keyword">for</span> clf_label<span class="token punctuation">,</span> clf <span class="token keyword">in</span> zip<span class="token punctuation">(</span>clf_labels<span class="token punctuation">,</span> all_clf<span class="token punctuation">)</span><span class="token punctuation">:</span>
    scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>estimator<span class="token operator">=</span>clf<span class="token punctuation">,</span> X<span class="token operator">=</span>X_train_std<span class="token punctuation">,</span> y<span class="token operator">=</span>y_train<span class="token punctuation">,</span>
                        verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Accuracy : %0.2f (+/- %0.2f) [%s]"</span>
         <span class="token operator">%</span> <span class="token punctuation">(</span>scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scores<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clf_label<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    2.1s finished
[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy : 0.77 (+/- 0.03) [随即森林]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    0.1s finished
[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy : 0.76 (+/- 0.02) [多数票机制]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:    9.3s finished
[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.


Accuracy : 0.73 (+/- 0.00) [bagging]
Accuracy : 0.72 (+/- 0.02) [Adaboost]


[Parallel(n_jobs=1)]: Done   5 out of   5 | elapsed:   12.9s finished</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 其他模型的测试集准确率：</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score
forest<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_pred_forest <span class="token operator">=</span> forest<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的accuracy：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_pred_forest<span class="token punctuation">)</span><span class="token punctuation">)</span>

mv_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_test_pred_vote <span class="token operator">=</span> forest<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'多数票机制在测试集上的accuracy：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred_vote<span class="token punctuation">)</span><span class="token punctuation">)</span>

lr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_test_pred_lr <span class="token operator">=</span> lr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'逻辑回归在测试集上的accuracy：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred_lr<span class="token punctuation">)</span><span class="token punctuation">)</span>

svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_pred_svm<span class="token operator">=</span>svm<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SVM在测试集上的accuracy：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_pred_svm<span class="token punctuation">)</span><span class="token punctuation">)</span>

knn<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_pred_knn<span class="token operator">=</span>knn<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'KNN在测试集上的accuracy：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_pred_knn<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>随机森林在测试集上的accuracy： 0.76
多数票机制在测试集上的accuracy： 0.76
逻辑回归在测试集上的accuracy： 0.76
SVM在测试集上的accuracy： 0.74
KNN在测试集上的accuracy： 0.6966666666666667</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">##最优模型预测测试集 , 准确率，召回率，调和值，和auc，并绘制roc曲线</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> precision_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> f1_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> recall_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve<span class="token punctuation">,</span>auc
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_auc_score
forest<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> forest<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> forest<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在训练集上的precision准确率：'</span><span class="token punctuation">,</span>precision_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的precision准确率：'</span><span class="token punctuation">,</span>precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的召回率：'</span><span class="token punctuation">,</span>recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的f1调和值：'</span><span class="token punctuation">,</span>f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的AUC：'</span><span class="token punctuation">,</span>roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_true<span class="token operator">=</span>y_test<span class="token punctuation">,</span>y_score<span class="token operator">=</span>y_test_pred<span class="token punctuation">)</span>
roc_auc <span class="token operator">=</span> auc<span class="token punctuation">(</span>x <span class="token operator">=</span>fpr<span class="token punctuation">,</span>y<span class="token operator">=</span>tpr<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> 
             color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> 
             linestyle<span class="token operator">=</span><span class="token string">'-.'</span><span class="token punctuation">,</span> 
             label<span class="token operator">=</span><span class="token string">'RandomForest (auc = %0.2f)'</span> <span class="token operator">%</span> roc_auc<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'lower right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
         linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span> 
         color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> 
         linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'False Positive Rate'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Positive Rate'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre><code>随机森林在训练集上的precision准确率： 1.0
随机森林在测试集上的precision准确率： 0.725
随机森林在测试集上的召回率： 0.32222222222222224
随机森林在测试集上的f1调和值： 0.4461538461538462
随机森林在测试集上的AUC： 0.6349206349206349</code></pre>
<p><img src="output_31_1.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 查看数据拟合情况</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> learning_curve
train_sizes<span class="token punctuation">,</span> train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span>learning_curve<span class="token punctuation">(</span>estimator<span class="token operator">=</span>forest<span class="token punctuation">,</span>
                                                        X<span class="token operator">=</span>X_train_std<span class="token punctuation">,</span>
                                                        y<span class="token operator">=</span>y_train<span class="token punctuation">,</span>
                                                        train_sizes<span class="token operator">=</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>
                                                        <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                        cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
                                                        n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
train_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
train_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># plot train_mean</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> train_mean<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>
        marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span>markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'training accuracy'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># plot train_std</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> 
                 train_mean <span class="token operator">+</span> train_std<span class="token punctuation">,</span>
                 train_mean <span class="token operator">-</span> train_std<span class="token punctuation">,</span>
                 alpha<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># plot test_mean</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> test_mean<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span>
        linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'s'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
        label<span class="token operator">=</span><span class="token string">'validation accuracy'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># plot test_std</span>
plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>train_sizes<span class="token punctuation">,</span> 
                 test_mean <span class="token operator">+</span> test_std<span class="token punctuation">,</span>
                 test_mean <span class="token operator">-</span> test_std<span class="token punctuation">,</span>
                 alpha<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Number of training samples'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'lower right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.01</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="output_32_0.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 验证曲线 可以进行基本的参数调优 并查看数据拟合情况</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> validation_curve
<span class="token keyword">import</span> matplotlib
<span class="token comment" spellcheck="true"># 设定参数选项  ##针对一个参数 max_depth</span>
param_range <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>  

<span class="token comment" spellcheck="true"># 通过 CV 获得不同参数的模型效果</span>
train_scores<span class="token punctuation">,</span> test_scores <span class="token operator">=</span> \
    validation_curve<span class="token punctuation">(</span>estimator<span class="token operator">=</span>forest<span class="token punctuation">,</span> 
                     X<span class="token operator">=</span>X_train_std<span class="token punctuation">,</span> y<span class="token operator">=</span>y_train<span class="token punctuation">,</span> 
                     param_name<span class="token operator">=</span><span class="token string">'max_depth'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 用 max_depth 找到参数对应的名称</span>
                     param_range<span class="token operator">=</span>param_range<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

train_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
train_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>train_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
test_std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>test_scores<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> train_mean<span class="token punctuation">,</span> 
         color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span> 
         markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'training accuracy'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> train_mean <span class="token operator">+</span> train_std<span class="token punctuation">,</span>
                 train_mean <span class="token operator">-</span> train_std<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">,</span>
                 color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> test_mean<span class="token punctuation">,</span> 
         color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span> 
         marker<span class="token operator">=</span><span class="token string">'s'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> 
         label<span class="token operator">=</span><span class="token string">'validation accuracy'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>param_range<span class="token punctuation">,</span> 
                 test_mean <span class="token operator">+</span> test_std<span class="token punctuation">,</span>
                 test_mean <span class="token operator">-</span> test_std<span class="token punctuation">,</span> 
                 alpha<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
matplotlib<span class="token punctuation">.</span>rcParams<span class="token punctuation">.</span>update<span class="token punctuation">(</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
<span class="token string">'text.usetex'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
<span class="token string">'font.family'</span><span class="token punctuation">:</span> <span class="token string">'stixgeneral'</span><span class="token punctuation">,</span>
<span class="token string">'mathtext.fontset'</span><span class="token punctuation">:</span> <span class="token string">'stix'</span><span class="token punctuation">,</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># plt.xscale('log')</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'lower right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Parameter max_depth'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Accuracy'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.03</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="output_33_0.png" alt="png"></p>
<p>  4-超参数调优 并选择最优模型## 网格搜索  随机森林篇</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 其他参数随机森林模型（暂时最好）</span>
rf_best <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>criterion<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span> 
                                 max_depth<span class="token operator">=</span> None<span class="token punctuation">,</span> max_features<span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span> 
                                 n_estimators<span class="token operator">=</span><span class="token number">250</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
scores_train <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>rf_best<span class="token punctuation">,</span> X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'CV accuracy:'</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>scores_train<span class="token punctuation">)</span><span class="token punctuation">)</span>
rf_best<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
y_prediction <span class="token operator">=</span> rf_best<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test accuracy: %.3f'</span> <span class="token operator">%</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prediction<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test AUC: %.3f'</span> <span class="token operator">%</span> roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prediction<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>CV accuracy: 0.7757142857142857
Test accuracy: 0.777
Test AUC: 0.675</code></pre>
<h2 id="SVM篇"><a href="#SVM篇" class="headerlink" title="SVM篇"></a>SVM篇</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 逻辑回归篇</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> RandomizedSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">import</span> expon
lr_n <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># param_range = [10**c for c in range(-4,4)]</span>
param_range <span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">]</span>
param_dist <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'C': param_range, </span>
              <span class="token string">'penalty'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'l1'</span><span class="token punctuation">,</span><span class="token string">'l2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'solver'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'liblinear'</span><span class="token punctuation">,</span><span class="token string">'lbfgs'</span><span class="token punctuation">,</span><span class="token string">'newton-cg'</span><span class="token punctuation">,</span><span class="token string">'sag'</span><span class="token punctuation">]</span>
             <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>

rs_lr <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token operator">=</span>lr_n<span class="token punctuation">,</span> 
                        param_grid<span class="token operator">=</span>param_dist<span class="token punctuation">,</span>  
                        scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">,</span>
                        cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

rs_lr <span class="token operator">=</span> rs_lr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'CV accuracy:'</span><span class="token punctuation">,</span>rs_lr<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span> 
clf_best_lr <span class="token operator">=</span> rs_lr<span class="token punctuation">.</span>best_estimator_
clf_best_lr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test accuracy: %.3f'</span> <span class="token operator">%</span> clf_best_lr<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test_std<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rs_lr<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span></code></pre>
<pre><code>CV accuracy: 0.75
Test accuracy: 0.773
{'C': 0.01, 'penalty': 'l2', 'solver': 'liblinear'}</code></pre>
<h2 id="KNN篇"><a href="#KNN篇" class="headerlink" title="KNN篇"></a>KNN篇</h2><p> 5-特征选择</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#包裹式特征选择方法SBS</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>base <span class="token keyword">import</span> clone 
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> combinations 
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np 
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score 
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">class</span> <span class="token class-name">SBS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">''' 
    k_features: 想要返回的理想特征数 
    '''</span> 
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> estimator<span class="token punctuation">,</span> k_features<span class="token punctuation">,</span>scoring<span class="token operator">=</span>accuracy_score<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>scoring <span class="token operator">=</span> scoring 
        self<span class="token punctuation">.</span>estimator <span class="token operator">=</span> clone<span class="token punctuation">(</span>estimator<span class="token punctuation">)</span> 
        self<span class="token punctuation">.</span>k_features <span class="token operator">=</span> k_features 
        self<span class="token punctuation">.</span>test_size <span class="token operator">=</span> test_size 
        self<span class="token punctuation">.</span>random_state <span class="token operator">=</span> random_state
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span>self<span class="token punctuation">.</span>test_size<span class="token punctuation">,</span> random_state<span class="token operator">=</span>self<span class="token punctuation">.</span>random_state<span class="token punctuation">)</span>
        dim <span class="token operator">=</span> X_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>indices_ <span class="token operator">=</span> tuple<span class="token punctuation">(</span>range<span class="token punctuation">(</span>dim<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        self<span class="token punctuation">.</span>subsets_ <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>indices_<span class="token punctuation">]</span>
        score <span class="token operator">=</span> self<span class="token punctuation">.</span>_calc_score<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> self<span class="token punctuation">.</span>indices_<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>scores_ <span class="token operator">=</span> <span class="token punctuation">[</span>score<span class="token punctuation">]</span>
        <span class="token keyword">while</span> dim <span class="token operator">></span> self<span class="token punctuation">.</span>k_features<span class="token punctuation">:</span>
            scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            subsets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> p <span class="token keyword">in</span> combinations<span class="token punctuation">(</span>self<span class="token punctuation">.</span>indices_<span class="token punctuation">,</span> r<span class="token operator">=</span>dim<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                score <span class="token operator">=</span> self<span class="token punctuation">.</span>_calc_score<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
                scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>score<span class="token punctuation">)</span> 
                subsets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
            best <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>scores<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>indices_ <span class="token operator">=</span> subsets<span class="token punctuation">[</span>best<span class="token punctuation">]</span> 
            self<span class="token punctuation">.</span>subsets_<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>indices_<span class="token punctuation">)</span>
            dim<span class="token operator">-=</span><span class="token number">1</span>
            self<span class="token punctuation">.</span>scores_<span class="token punctuation">.</span>append<span class="token punctuation">(</span>scores<span class="token punctuation">[</span>best<span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>k_score_ <span class="token operator">=</span> self<span class="token punctuation">.</span>scores_<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> self
    <span class="token keyword">def</span> <span class="token function">transform</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span> 
        <span class="token keyword">return</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>indices_<span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">_calc_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> indices<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> indices<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">)</span> 
        y_pred <span class="token operator">=</span> self<span class="token punctuation">.</span>estimator<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> indices<span class="token punctuation">]</span><span class="token punctuation">)</span> 
        score <span class="token operator">=</span> self<span class="token punctuation">.</span>scoring<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span> 
        <span class="token keyword">return</span> score

<span class="token comment" spellcheck="true">#使用逻辑回归分类器实现SBS</span>
rf_base <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>criterion<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span> 
                                 max_depth<span class="token operator">=</span> None<span class="token punctuation">,</span>
                                 n_estimators<span class="token operator">=</span><span class="token number">250</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
sbs<span class="token operator">=</span>SBS<span class="token punctuation">(</span>rf_base<span class="token punctuation">,</span>k_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
sbs<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span></code></pre>
<pre><code>&lt;__main__.SBS at 0x186b5ed7f60&gt;</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#绘制验证数据集上计算的随机森林分类器的分类准确度 </span>
k_feat <span class="token operator">=</span> <span class="token punctuation">[</span>len<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> sbs<span class="token punctuation">.</span>subsets_<span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>k_feat<span class="token punctuation">,</span> sbs<span class="token punctuation">.</span>scores_<span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1.02</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Accuracy'</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Number of features'</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="output_44_0.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#选取最优特征子集</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sbs<span class="token punctuation">.</span>subsets_<span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
k15<span class="token operator">=</span>list<span class="token punctuation">(</span>sbs<span class="token punctuation">.</span>subsets_<span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>columns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<pre><code>(0, 1, 2, 4, 5, 7, 10, 12, 16, 24, 26, 30, 32, 33, 36)
Index(['Credit amount', 'Installment rate', 'Present residence',
       'Existing credits number', 'Maintenance number',
       'Existing checking accout_A11', 'Existing checking accout_A14',
       'Credit history_A31', 'Purpurse_A40', 'Purpurse_A48',
       'Savings account_A61', 'Savings account_A65', 'Present employment_A72',
       'Present employment_A73', 'Status and sex_A91'],
      dtype='object')</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#评估性能</span>
<span class="token comment" spellcheck="true">#原始测试集上的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'逻辑回归在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#特征选择后的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'特征选择后逻辑回归在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'特征选择后逻辑回归在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>随机森林在训练集上的准确率： 1.0
逻辑回归在测试集上的准确率： 0.77
特征选择后逻辑回归在训练集上的准确率： 1.0
特征选择后逻辑回归在测试集上的准确率： 0.7766666666666666</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#包裹式特征选择方法RFECV</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> StratifiedKFold
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_selection <span class="token keyword">import</span> RFECV
rfecv <span class="token operator">=</span> RFECV<span class="token punctuation">(</span>rf_base<span class="token punctuation">,</span>          <span class="token comment" spellcheck="true"># 学习器</span>
              step<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>                 <span class="token comment" spellcheck="true"># 每次移除特征个数</span>
<span class="token comment" spellcheck="true">#               n_features_to_select=15, # 要选出几个 feature</span>
              cv<span class="token operator">=</span>StratifiedKFold<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># 交叉验证次数</span>
              scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">,</span>     <span class="token comment" spellcheck="true"># 学习器的评价标准</span>
              verbose <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
              n_jobs <span class="token operator">=</span> <span class="token number">1</span>
              <span class="token punctuation">)</span>
rfecv<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
X_rfecv_selected <span class="token operator">=</span> rfecv<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 查看选出了哪几个 feature </span>
mask <span class="token operator">=</span> rfecv<span class="token punctuation">.</span>get_support<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>matshow<span class="token punctuation">(</span>mask<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray_r'</span><span class="token punctuation">)</span></code></pre>
<pre><code>Fitting estimator with 62 features.
Fitting estimator with 61 features.
Fitting estimator with 60 features.
Fitting estimator with 59 features.
Fitting estimator with 58 features.
Fitting estimator with 57 features.
Fitting estimator with 56 features.
Fitting estimator with 55 features.
Fitting estimator with 54 features.
Fitting estimator with 53 features.
Fitting estimator with 52 features.
Fitting estimator with 51 features.
Fitting estimator with 50 features.
Fitting estimator with 49 features.
Fitting estimator with 48 features.
Fitting estimator with 47 features.
Fitting estimator with 46 features.
Fitting estimator with 45 features.
Fitting estimator with 44 features.
Fitting estimator with 43 features.
Fitting estimator with 42 features.
Fitting estimator with 41 features.
Fitting estimator with 40 features.
Fitting estimator with 39 features.
Fitting estimator with 38 features.
Fitting estimator with 37 features.
Fitting estimator with 36 features.
Fitting estimator with 35 features.
Fitting estimator with 34 features.
Fitting estimator with 33 features.
Fitting estimator with 32 features.
Fitting estimator with 31 features.
Fitting estimator with 30 features.
Fitting estimator with 29 features.
Fitting estimator with 28 features.
Fitting estimator with 27 features.
Fitting estimator with 26 features.
Fitting estimator with 25 features.
Fitting estimator with 24 features.
Fitting estimator with 23 features.
Fitting estimator with 22 features.
Fitting estimator with 21 features.
Fitting estimator with 20 features.
Fitting estimator with 19 features.
Fitting estimator with 18 features.
Fitting estimator with 17 features.
Fitting estimator with 16 features.
Fitting estimator with 15 features.
Fitting estimator with 14 features.
Fitting estimator with 13 features.
Fitting estimator with 12 features.
Fitting estimator with 11 features.
Fitting estimator with 10 features.
Fitting estimator with 9 features.
Fitting estimator with 8 features.
Fitting estimator with 7 features.
Fitting estimator with 6 features.
Fitting estimator with 5 features.
Fitting estimator with 4 features.
Fitting estimator with 3 features.
Fitting estimator with 2 features.
Fitting estimator with 62 features.
Fitting estimator with 61 features.
Fitting estimator with 60 features.
Fitting estimator with 59 features.
Fitting estimator with 58 features.
Fitting estimator with 57 features.
Fitting estimator with 56 features.
Fitting estimator with 55 features.
Fitting estimator with 54 features.
Fitting estimator with 53 features.
Fitting estimator with 52 features.
Fitting estimator with 51 features.
Fitting estimator with 50 features.
Fitting estimator with 49 features.
Fitting estimator with 48 features.
Fitting estimator with 47 features.
Fitting estimator with 46 features.
Fitting estimator with 45 features.
Fitting estimator with 44 features.
Fitting estimator with 43 features.
Fitting estimator with 42 features.
Fitting estimator with 41 features.
Fitting estimator with 40 features.
Fitting estimator with 39 features.
Fitting estimator with 38 features.
Fitting estimator with 37 features.
Fitting estimator with 36 features.
Fitting estimator with 35 features.
Fitting estimator with 34 features.
Fitting estimator with 33 features.
Fitting estimator with 32 features.
Fitting estimator with 31 features.
Fitting estimator with 30 features.
Fitting estimator with 29 features.
Fitting estimator with 28 features.
Fitting estimator with 27 features.
Fitting estimator with 26 features.
Fitting estimator with 25 features.
Fitting estimator with 24 features.
Fitting estimator with 23 features.
Fitting estimator with 22 features.
Fitting estimator with 21 features.
Fitting estimator with 20 features.
Fitting estimator with 19 features.
Fitting estimator with 18 features.
Fitting estimator with 17 features.
Fitting estimator with 16 features.
Fitting estimator with 15 features.
Fitting estimator with 14 features.
Fitting estimator with 13 features.
Fitting estimator with 12 features.
Fitting estimator with 11 features.
Fitting estimator with 10 features.
Fitting estimator with 9 features.
Fitting estimator with 8 features.
Fitting estimator with 7 features.
Fitting estimator with 6 features.
Fitting estimator with 5 features.
Fitting estimator with 4 features.
Fitting estimator with 3 features.
Fitting estimator with 2 features.
Fitting estimator with 62 features.
Fitting estimator with 61 features.
Fitting estimator with 60 features.
Fitting estimator with 59 features.
Fitting estimator with 58 features.
Fitting estimator with 57 features.
Fitting estimator with 56 features.
Fitting estimator with 55 features.
Fitting estimator with 54 features.
Fitting estimator with 53 features.
Fitting estimator with 52 features.
Fitting estimator with 51 features.
Fitting estimator with 50 features.
Fitting estimator with 49 features.
Fitting estimator with 48 features.
Fitting estimator with 47 features.
Fitting estimator with 46 features.
Fitting estimator with 45 features.
Fitting estimator with 44 features.
Fitting estimator with 43 features.
Fitting estimator with 42 features.
Fitting estimator with 41 features.
Fitting estimator with 40 features.
Fitting estimator with 39 features.
Fitting estimator with 38 features.
Fitting estimator with 37 features.
Fitting estimator with 36 features.
Fitting estimator with 35 features.
Fitting estimator with 34 features.
Fitting estimator with 33 features.
Fitting estimator with 32 features.
Fitting estimator with 31 features.
Fitting estimator with 30 features.
Fitting estimator with 29 features.
Fitting estimator with 28 features.
Fitting estimator with 27 features.
Fitting estimator with 26 features.
Fitting estimator with 25 features.
Fitting estimator with 24 features.
Fitting estimator with 23 features.
Fitting estimator with 22 features.
Fitting estimator with 21 features.
Fitting estimator with 20 features.
Fitting estimator with 19 features.
Fitting estimator with 18 features.
Fitting estimator with 17 features.
Fitting estimator with 16 features.
Fitting estimator with 15 features.
Fitting estimator with 14 features.
Fitting estimator with 13 features.
Fitting estimator with 12 features.
Fitting estimator with 11 features.
Fitting estimator with 10 features.
Fitting estimator with 9 features.
Fitting estimator with 8 features.
Fitting estimator with 7 features.
Fitting estimator with 6 features.
Fitting estimator with 5 features.
Fitting estimator with 4 features.
Fitting estimator with 3 features.
Fitting estimator with 2 features.
Fitting estimator with 62 features.
Fitting estimator with 61 features.
Fitting estimator with 60 features.
Fitting estimator with 59 features.
Fitting estimator with 58 features.
Fitting estimator with 57 features.
Fitting estimator with 56 features.
Fitting estimator with 55 features.
Fitting estimator with 54 features.
Fitting estimator with 53 features.
Fitting estimator with 52 features.
Fitting estimator with 51 features.
Fitting estimator with 50 features.
Fitting estimator with 49 features.
Fitting estimator with 48 features.
Fitting estimator with 47 features.
Fitting estimator with 46 features.
Fitting estimator with 45 features.
Fitting estimator with 44 features.
Fitting estimator with 43 features.
Fitting estimator with 42 features.
Fitting estimator with 41 features.
Fitting estimator with 40 features.
Fitting estimator with 39 features.
Fitting estimator with 38 features.
Fitting estimator with 37 features.
Fitting estimator with 36 features.
Fitting estimator with 35 features.
Fitting estimator with 34 features.
Fitting estimator with 33 features.
Fitting estimator with 32 features.
Fitting estimator with 31 features.
Fitting estimator with 30 features.
Fitting estimator with 29 features.
Fitting estimator with 28 features.
Fitting estimator with 27 features.
Fitting estimator with 26 features.
Fitting estimator with 25 features.
Fitting estimator with 24 features.
Fitting estimator with 23 features.
Fitting estimator with 22 features.
Fitting estimator with 21 features.
Fitting estimator with 20 features.
Fitting estimator with 19 features.
Fitting estimator with 18 features.
Fitting estimator with 17 features.
Fitting estimator with 16 features.
Fitting estimator with 15 features.
Fitting estimator with 14 features.
Fitting estimator with 13 features.
Fitting estimator with 12 features.
Fitting estimator with 11 features.
Fitting estimator with 10 features.
Fitting estimator with 9 features.
Fitting estimator with 8 features.
Fitting estimator with 7 features.
Fitting estimator with 6 features.
Fitting estimator with 5 features.
Fitting estimator with 4 features.
Fitting estimator with 3 features.
Fitting estimator with 2 features.
Fitting estimator with 62 features.
Fitting estimator with 61 features.
Fitting estimator with 60 features.
Fitting estimator with 59 features.
Fitting estimator with 58 features.
Fitting estimator with 57 features.
Fitting estimator with 56 features.
Fitting estimator with 55 features.
Fitting estimator with 54 features.
Fitting estimator with 53 features.
Fitting estimator with 52 features.
Fitting estimator with 51 features.
Fitting estimator with 50 features.
Fitting estimator with 49 features.
Fitting estimator with 48 features.
Fitting estimator with 47 features.
Fitting estimator with 46 features.
Fitting estimator with 45 features.
Fitting estimator with 44 features.
Fitting estimator with 43 features.
Fitting estimator with 42 features.
Fitting estimator with 41 features.
Fitting estimator with 40 features.
Fitting estimator with 39 features.
Fitting estimator with 38 features.
Fitting estimator with 37 features.
Fitting estimator with 36 features.
Fitting estimator with 35 features.
Fitting estimator with 34 features.
Fitting estimator with 33 features.
Fitting estimator with 32 features.
Fitting estimator with 31 features.
Fitting estimator with 30 features.
Fitting estimator with 29 features.
Fitting estimator with 28 features.
Fitting estimator with 27 features.
Fitting estimator with 26 features.
Fitting estimator with 25 features.
Fitting estimator with 24 features.
Fitting estimator with 23 features.
Fitting estimator with 22 features.
Fitting estimator with 21 features.
Fitting estimator with 20 features.
Fitting estimator with 19 features.
Fitting estimator with 18 features.
Fitting estimator with 17 features.
Fitting estimator with 16 features.
Fitting estimator with 15 features.
Fitting estimator with 14 features.
Fitting estimator with 13 features.
Fitting estimator with 12 features.
Fitting estimator with 11 features.
Fitting estimator with 10 features.
Fitting estimator with 9 features.
Fitting estimator with 8 features.
Fitting estimator with 7 features.
Fitting estimator with 6 features.
Fitting estimator with 5 features.
Fitting estimator with 4 features.
Fitting estimator with 3 features.
Fitting estimator with 2 features.
Fitting estimator with 62 features.
Fitting estimator with 61 features.
Fitting estimator with 60 features.
Fitting estimator with 59 features.
Fitting estimator with 58 features.
Fitting estimator with 57 features.
Fitting estimator with 56 features.
Fitting estimator with 55 features.
Fitting estimator with 54 features.
Fitting estimator with 53 features.
Fitting estimator with 52 features.
Fitting estimator with 51 features.
Fitting estimator with 50 features.
Fitting estimator with 49 features.
Fitting estimator with 48 features.
Fitting estimator with 47 features.
Fitting estimator with 46 features.
Fitting estimator with 45 features.
Fitting estimator with 44 features.
Fitting estimator with 43 features.
Fitting estimator with 42 features.
Fitting estimator with 41 features.
Fitting estimator with 40 features.
[ True  True  True  True  True  True  True  True  True False  True False
  True  True False  True  True False False  True  True False False False
 False  True  True False False False  True False  True  True  True  True
 False  True  True False  True  True  True False False  True  True  True
  True False False  True False  True  True  True False  True  True False
 False  True]





&lt;matplotlib.image.AxesImage at 0x186b6d25e10&gt;</code></pre>
<p><img src="output_47_2.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#展示</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>columns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"得到的特征数量:"</span><span class="token punctuation">,</span>rfecv<span class="token punctuation">.</span>n_features_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"特征等级:"</span><span class="token punctuation">,</span>list<span class="token punctuation">(</span>rfecv<span class="token punctuation">.</span>ranking_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"交叉验证的CV分数:"</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>rfecv<span class="token punctuation">.</span>grid_scores_<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>Index(['Credit amount', 'Installment rate', 'Present residence', 'Age',
       'Existing credits number', 'Maintenance number', 'target',
       'Existing checking accout_A11', 'Existing checking accout_A12',
       'Existing checking accout_A14', 'Credit history_A31',
       'Credit history_A32', 'Credit history_A34', 'Purpurse_A40',
       'Purpurse_A42', 'Purpurse_A43', 'Purpurse_A49', 'Savings account_A61',
       'Savings account_A65', 'Present employment_A72',
       'Present employment_A73', 'Present employment_A74',
       'Present employment_A75', 'Status and sex_A92', 'Status and sex_A93',
       'Property_A121', 'Property_A122', 'Property_A123', 'Job_A172',
       'Job_A173', 'Job_A174', 'Other debtors_A101', 'Installmentplans_A141',
       'Installmentplans_A143', 'Housing state_A151', 'Housing state_A152',
       'Telephone_A191', 'Telephone_A192', 'age_bin'],
      dtype='object')
得到的特征数量: 39
特征等级: [1, 1, 1, 1, 1, 1, 1, 1, 1, 11, 1, 7, 1, 1, 3, 1, 1, 2, 23, 1, 1, 21, 17, 6, 24, 1, 1, 5, 16, 18, 1, 8, 1, 1, 1, 1, 15, 1, 1, 10, 1, 1, 1, 4, 20, 1, 1, 1, 1, 9, 13, 1, 12, 1, 1, 1, 14, 1, 1, 22, 19, 1]
交叉验证的CV分数: 0.743225806451613</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#评估性能</span>
<span class="token comment" spellcheck="true">#原始测试集上的性能</span>
rf_base <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>criterion<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span> 
                                 max_depth<span class="token operator">=</span> None<span class="token punctuation">,</span>
                                 n_estimators<span class="token operator">=</span><span class="token number">250</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#特征选择后的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>mask<span class="token punctuation">]</span><span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'特征选择后随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'特征选择后随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>随机森林在训练集上的准确率： 1.0
随机森林在测试集上的准确率： 0.77
特征选择后随机森林在训练集上的准确率： 1.0
特征选择后随机森林在测试集上的准确率： 0.7566666666666667</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#基于树的模型特征选择</span>
rf_base <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>criterion<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span> 
                                 max_depth<span class="token operator">=</span> None<span class="token punctuation">,</span>
                                 n_estimators<span class="token operator">=</span><span class="token number">250</span><span class="token punctuation">,</span> oob_score<span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
feat_labels <span class="token operator">=</span> data<span class="token punctuation">.</span>columns
importances <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>feature_importances_
indices <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>importances<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">##从大到小</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> idx <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>indices<span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%2d) %s %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> feat_labels<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> importances<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">## 可视化 </span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Feature Importances'</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>range<span class="token punctuation">(</span>X_train_std<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> importances<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'lightblue'</span><span class="token punctuation">,</span> align<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>range<span class="token punctuation">(</span>X_train_std<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> feat_labels<span class="token punctuation">[</span>indices<span class="token punctuation">]</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> X_train_std<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre><code> 1) Credit amount 0.099694
 2) Duration in month 0.069669
 3) Age 0.068704
 4) Existing checking accout_A13 0.044726
 5) Installment rate 0.037383
 6) Present residence 0.032810
 7) Foreign worker_A202 0.029428
 8) target 0.029389
 9) Credit history_A33 0.023620
10) Existing credits number 0.019204
11) Purpurse_A49 0.019041
12) Credit history_A34 0.018378
13) Installmentplans_A142 0.018066
14) Purpurse_A42 0.016318
15) Job_A172 0.015945
16) Credit history_A30 0.015873
17) Status and sex_A94 0.015855
18) Present employment_A72 0.014965
19) Present employment_A71 0.014814
20) Status and sex_A91 0.014794
21) Housing state_A151 0.014670
22) Existing checking accout_A11 0.014617
23) Property_A121 0.014389
24) Other debtors_A103 0.014310
25) Status and sex_A92 0.013944
26) Housing state_A153 0.013667
27) Installmentplans_A143 0.013648
28) Credit history_A31 0.013416
29) Property_A122 0.013412
30) Savings account_A64 0.013317
31) Purpurse_A48 0.013179
32) Present employment_A74 0.012931
33) Telephone_A191 0.012873
34) Purpurse_A410 0.011904
35) Present employment_A73 0.010883
36) Job_A171 0.010740
37) Maintenance number 0.010490
38) Purpurse_A40 0.010386
39) Job_A173 0.010016
40) Credit history_A32 0.009622
41) Property_A123 0.009524
42) Existing checking accout_A14 0.009270
43) Job_A174 0.008907
44) Other debtors_A101 0.008810
45) Savings account_A65 0.008774
46) Savings account_A61 0.008613
47) Purpurse_A45 0.008079
48) Status and sex_A93 0.007646
49) Other debtors_A102 0.007389
50) Installmentplans_A141 0.007388
51) Existing checking accout_A12 0.007069
52) Present employment_A75 0.006248
53) Housing state_A152 0.006015
54) Savings account_A62 0.005073
55) Purpurse_A44 0.004619
56) Savings account_A63 0.004400
57) Foreign worker_A201 0.002616
58) Telephone_A192 0.002424
59) Purpurse_A43 0.001994
60) Property_A124 0.001650
61) Purpurse_A41 0.001459
62) Purpurse_A46 0.000946</code></pre>
<p><img src="output_50_1.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#利用sklearn的SelectFromModel，根据用户指定的阈值选择特征</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_selection <span class="token keyword">import</span> SelectFromModel
select_rf <span class="token operator">=</span> SelectFromModel<span class="token punctuation">(</span>rf_base<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">0.015</span><span class="token punctuation">,</span> prefit<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
X_selected <span class="token operator">=</span> select_rf<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X_train_std<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 原始特征维度 </span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X_selected<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 特征选择后特征维度</span>
<span class="token keyword">for</span> f <span class="token keyword">in</span> range<span class="token punctuation">(</span>X_selected<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%2d) %s %f"</span> <span class="token operator">%</span><span class="token punctuation">(</span>f<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> feat_labels<span class="token punctuation">[</span>indices<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> importances<span class="token punctuation">[</span>indices<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"所选特征数量:"</span><span class="token punctuation">,</span>X_selected<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<pre><code>62
17
 1) Credit amount 0.099694
 2) Duration in month 0.069669
 3) Age 0.068704
 4) Existing checking accout_A13 0.044726
 5) Installment rate 0.037383
 6) Present residence 0.032810
 7) Foreign worker_A202 0.029428
 8) target 0.029389
 9) Credit history_A33 0.023620
10) Existing credits number 0.019204
11) Purpurse_A49 0.019041
12) Credit history_A34 0.018378
13) Installmentplans_A142 0.018066
14) Purpurse_A42 0.016318
15) Job_A172 0.015945
16) Credit history_A30 0.015873
17) Status and sex_A94 0.015855
所选特征数量: 17</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 可视化特征选择结果，黑色的是选中的，白色的是滤过的</span>
mask1 <span class="token operator">=</span> select_rf<span class="token punctuation">.</span>get_support<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#评估性能</span>
<span class="token comment" spellcheck="true">#原始测试集上的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#特征选择后的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>mask1<span class="token punctuation">]</span><span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>mask1<span class="token punctuation">]</span><span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>mask1<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'特征选择后随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'特征选择后随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>随机森林在训练集上的准确率： 1.0
随机森林在测试集上的准确率： 0.77
特征选择后随机森林在训练集上的准确率： 1.0
特征选择后随机森林在测试集上的准确率： 0.77</code></pre>
<p>  6-PCA/LDA降维</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#PCA主成分分析方法</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>decomposition <span class="token keyword">import</span> PCA
pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_train_pca <span class="token operator">=</span> pca<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span> 
pca<span class="token punctuation">.</span>explained_variance_ratio_</code></pre>
<pre><code>array([0.13289936, 0.1133389 , 0.08963202, 0.0861605 , 0.08535397,
       0.07832916, 0.06808131, 0.06454949, 0.06311886, 0.05496602,
       0.05342284, 0.03512715, 0.03293817, 0.02445198, 0.01763028])</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#评估性能</span>
<span class="token comment" spellcheck="true">#原始测试集上的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#特征选择后的性能</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SBS特征选择后随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SBS特征选择后随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#特征降维后的性能</span>
<span class="token comment" spellcheck="true">#选择前n_components个主成分 </span>
pca <span class="token operator">=</span> PCA<span class="token punctuation">(</span>n_components<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span> 
X_train_pca <span class="token operator">=</span> pca<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span> 
X_test_pca <span class="token operator">=</span> pca<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">)</span>
rf_base<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_pca<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
y_train_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_pca<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> rf_base<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_pca<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'PCA特征降维后随机森林在训练集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span>y_train_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'PCA特征降维后随机森林在测试集上的准确率：'</span><span class="token punctuation">,</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span>y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>随机森林在训练集上的准确率： 1.0
随机森林在测试集上的准确率： 0.77
SBS特征选择后随机森林在训练集上的准确率： 1.0
SBS特征选择后随机森林在测试集上的准确率： 0.7766666666666666
PCA特征降维后随机森林在训练集上的准确率： 1.0
PCA特征降维后随机森林在测试集上的准确率： 0.7766666666666666</code></pre>
<p>FIANL - 调参</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 网格搜索  基于pca数据</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> RandomizedSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
forest_n <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

param_dist <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'max_depth': [None],                     #</span>
              <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">#</span>
              <span class="token string">'max_features'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token comment" spellcheck="true">#</span>
              <span class="token string">'min_samples_split'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'min_samples_leaf'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'criterion'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'gini'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
              <span class="token string">'oob_score'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token comment" spellcheck="true">## 随即搜索  n_iter 抽样参数</span>
<span class="token comment" spellcheck="true"># np.random.seed(0)</span>
<span class="token comment" spellcheck="true"># rs_rf = RandomizedSearchCV(estimator=forest_n, </span>
<span class="token comment" spellcheck="true">#                         param_distributions=param_dist, </span>
<span class="token comment" spellcheck="true">#                         n_iter=50, scoring='accuracy',</span>
<span class="token comment" spellcheck="true">#                         cv=10, n_jobs=-1)</span>

rs_rf <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token operator">=</span>forest_n<span class="token punctuation">,</span> 
                        param_grid<span class="token operator">=</span>param_dist<span class="token punctuation">,</span>  
                        scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">,</span>
                        cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

rs_rf <span class="token operator">=</span> rs_rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_pca<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'CV accuracy:'</span><span class="token punctuation">,</span>rs_rf<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span>rs_rf<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span>

clf_best <span class="token operator">=</span> rs_rf<span class="token punctuation">.</span>best_estimator_
clf_best<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_pca<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test accuracy: %.3f'</span> <span class="token operator">%</span> clf_best<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test_pca<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>CV accuracy: 0.7585714285714286
{'criterion': 'gini', 'max_depth': None, 'max_features': 9, 'min_samples_leaf': 4, 'min_samples_split': 3, 'n_estimators': 250, 'oob_score': True}
Test accuracy: 0.780</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">## 网格搜索  基于SBS特征选择数据</span>
forest_n <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

param_dist <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'max_depth': [None],                     #</span>
              <span class="token string">'n_estimators'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">#</span>
              <span class="token string">'max_features'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token comment" spellcheck="true">#</span>
              <span class="token string">'min_samples_split'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'min_samples_leaf'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">'criterion'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'gini'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
              <span class="token string">'oob_score'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>

rs_rf <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token operator">=</span>forest_n<span class="token punctuation">,</span> 
                        param_grid<span class="token operator">=</span>param_dist<span class="token punctuation">,</span>  
                        scoring<span class="token operator">=</span><span class="token string">'accuracy'</span><span class="token punctuation">,</span>
                        cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

rs_rf <span class="token operator">=</span> rs_rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'CV accuracy:'</span><span class="token punctuation">,</span>rs_rf<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span>rs_rf<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span>

clf_best <span class="token operator">=</span> rs_rf<span class="token punctuation">.</span>best_estimator_
clf_best<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Test accuracy: %.3f'</span> <span class="token operator">%</span> clf_best<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test_std<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>k15<span class="token punctuation">]</span><span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>CV accuracy: 0.7728571428571428
{'criterion': 'gini', 'max_depth': None, 'max_features': 5, 'min_samples_leaf': 1, 'min_samples_split': 3, 'n_estimators': 250, 'oob_score': True}
Test accuracy: 0.777</code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">国祥</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://zgx43790.github.io/2020/05/02/xin-dai-yong-hu-fen-lei-yu-ce/">https://zgx43790.github.io/2020/05/02/xin-dai-yong-hu-fen-lei-yu-ce/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">国祥</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                                    <span class="chip bg-color">机器学习</span>
                                </a>
                            
                                <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                                    <span class="chip bg-color">学习笔记</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/05/12/te-zheng-gong-cheng-te-zheng-jiang-wei/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="特征降维">
                        
                        <span class="card-title">特征降维</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            特征降维
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-05-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="post-category">
                                    机器学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                        <span class="chip bg-color">机器学习</span>
                    </a>
                    
                    <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">学习笔记</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/04/20/network-seir/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/23.jpg" class="responsive-img" alt="基于复杂网络和SEIR传染病模型的COVID-19疫情发展仿真">
                        
                        <span class="card-title">基于复杂网络和SEIR传染病模型的COVID-19疫情发展仿真</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            基于复杂网络和SEIR传染病模型的COVID-19疫情发展仿真
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-04-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%A4%8D%E6%9D%82%E7%BD%91%E7%BB%9C-%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C/" class="post-category">
                                    复杂网络&社交网络
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                        <span class="chip bg-color">机器学习</span>
                    </a>
                    
                    <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                        <span class="chip bg-color">学习笔记</span>
                    </a>
                    
                    <a href="/tags/%E5%A4%8D%E6%9D%82%E7%BD%91%E7%BB%9C/">
                        <span class="chip bg-color">复杂网络</span>
                    </a>
                    
                    <a href="/tags/COVID-19/">
                        <span class="chip bg-color">COVID-19</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Singularity&#39;s Blog<br />'
            + '文章作者: 国祥<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.06'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            &copy;2020-2023 GuoXiang. 版权所有


            <span id="year">2020</span>
            <a href="/about" target="_blank">国祥</a>
            
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "08";
                    var startDate = "21";
                    var startHour = "18";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="ZGX43790" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:imsingularity@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=437904687" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 437904687" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
